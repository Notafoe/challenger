!function(t){function e(t){return"widget"===t.get("elType")&&"ha-hotspots"===t.get("widgetType")}var n=elementor.hooks.addFilter,o=(elementor.hooks.addAction,function(t){return{initialize:function(){t.prototype.initialize.apply(this,arguments),this.updateContextMenu(),this.addedByContextMenuData=null,this.listenTo(elementor.channels.dataEditMode,"switch",this.toggleSpotDragMode),this.listenTo(this.model.get("editSettings"),"change:activeItemIndex",this.onEditSettingsChange),this.listenTo(this.model.get("settings").get("spots"),"add",this.handleAddedByContextMenu)},handleAddedByContextMenu:function(t){var e=elementorFrontend.getCurrentDeviceMode(),n="desktop"===e?"":"_"+e,o=t,i={},a=this.$el.width(),s=this.$el.height(),d=this.addedByContextMenuData&&this.addedByContextMenuData.offsetX,r=this.addedByContextMenuData&&this.addedByContextMenuData.offsetY,u=o.get("x_pos"+n).unit,l=o.get("y_pos"+n).unit;_.isNull(this.addedByContextMenuData)||(d=(100*d/a).toFixed(2),r=(100*r/s).toFixed(2),i["x_pos"+n]={size:d,unit:u},i["y_pos"+n]={size:r,unit:l},o.setExternalChange(i),this.renderStyles(),this.addedByContextMenuData=null)},updateContextMenu:function(){var t=this.getBehavior("contextMenu"),e=t.getOption("groups"),n=_.findWhere(e,function(t){return"general"===t.name}),o=_.findIndex(n.actions,function(t){return"ha-add-hotspot"===t.name}),i=this;-1===o&&n.actions.push({name:"ha-add-hotspot",title:"Add Hotspot",icon:"hm hm-happyaddons",callback:function(){i.model.trigger("request:edit"),i.getSpotsView().onButtonAddRowClick()}}),t.options.groups=e,t.initContextMenu()},onEditSettingsChange:function(t){this.$el.find('[data-index="'+(t.get("activeItemIndex")-1)+'"]').addClass("ha-hotspots__item--focus").siblings(".ha-hotspots__item--focus").removeClass("ha-hotspots__item--focus")},getControlViewByName:function(t){return elementor.getPanelView().getCurrentPageView().children.find(function(e){return e.model.get("name")===t})},getSpotsView:function(){return $e.routes.isPartOf("panel/editor/content")||$e.route("panel/editor/content"),"_section_spots"!==this.model.get("editSettings").get("panel").activeSection&&this.getControlViewByName("_section_spots").ui.heading.click(),this.getControlViewByName("spots")},getSpotByIndex:function(t){return this.getSpotsView().children.findByIndex(t)},onRender:function(){t.prototype.onRender.call(this);var e=this;_.defer(function(){e.toggleSpotDragMode()})},onDestroy:function(){this.deactivateSpotDragMode(),t.prototype.onDestroy.call(this)},ui:function(){var e=t.__super__.ui.call(this);return e.spotHandle="> .elementor-widget-container .ha-hotspots__item",e},events:function(){var e=t.__super__.events.call(this);return e.contextmenu="onContextMenuOpen",e["click @ui.spotHandle"]="onClickSpot",e["dragstart @ui.spotHandle"]="openSelectedSpot",e["dragstop @ui.spotHandle"]="onDragSpotHandle",e},onContextMenuOpen:function(t){t.stopPropagation(),this.addedByContextMenuData=t},onClickSpot:function(t){t.preventDefault(),this.openSelectedSpot(t)},openSelectedSpot:function(t){t.stopPropagation(),this.model.trigger("request:edit");var e=this.getSpotByIndex(t.currentTarget.getAttribute("data-index")),n=e.ui.itemTitle;n.parent().next().hasClass("editable")||n.click()},onDragSpotHandle:function(t,e){t.stopPropagation();var n=elementorFrontend.getCurrentDeviceMode(),o="desktop"===n?"":"_"+n,i=this.getEditModel(),a=i.getSetting("spots"),s=e.helper,d=s.data("index"),r=a.at(d),u={},l=elementorFrontend.config.is_rtl,p=s.offsetParent().width(),h=s.offsetParent().height(),g=s.outerWidth(!0),c=e.position.left,f=p-c-g,m=l?f:c,x=e.position.top,_=r.get("x_pos"+o).unit,y=r.get("y_pos"+o).unit;m=(100*m/p).toFixed(2),x=(100*x/h).toFixed(2),u["x_pos"+o]={size:m,unit:_},u["y_pos"+o]={size:x,unit:y},r.setExternalChange(u),this.renderStyles();var C=setTimeout(function(){s.css({top:"",left:"",right:"",bottom:"",width:"",height:""}),clearTimeout(C)},250)},activateSpotDragMode:function(){this.ui.spotHandle.draggable({addClasses:!1})},deactivateSpotDragMode:function(){this.ui.spotHandle.draggable("instance")&&this.ui.spotHandle.draggable("destroy")},toggleSpotDragMode:function(){var t="edit"===elementor.channels.dataEditMode.request("activeMode");this.deactivateSpotDragMode(),t&&elementor.userCan("design")&&this.activateSpotDragMode()}}});n("element/view",function(t,n){return e(n)?t.extend(o(t)):t})}(jQuery);